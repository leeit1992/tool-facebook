!function(t){"use strict";new(Backbone.View.extend({el:"#page-manage-acc-fb",events:{"submit #atl-form-file":"uploadFile","click .avt-auto-add-acc-js":"autoAccFb","click .atl-action-apply-js":"actionManage","click .avt-delete-acc":"deleteFBacc"},errorFormTpl:_.template('<div class="uk-notify-message <%= classes %>">                                        <a class="uk-close"></a>                                        <div>                                           <%= message %>                                        </div>                                    </div>'),initialize:function(){t(".avt-facebook-acc-check-primary").on("ifChecked",function(e){t(".avt-facebook-acc-check-child").iCheck("check")}),t(".avt-facebook-acc-check-primary").on("ifUnchecked",function(e){t(".avt-facebook-acc-check-child").iCheck("uncheck")})},uploadFile:function(){var e=this,a=t("input[name=atl-upload-file]").prop("files")[0],c=a.type,s=["text/plain","application/msword"];if(c==s[0]||c==s[1]){var o=new FormData;o.append("file",a),t.ajax({url:AVTDATA.SITE_URL+"/upload-acc-fb",type:"POST",data:o,contentType:!1,processData:!1,success:function(a){var c=JSON.parse(a);if(c.data){var s=e.errorFormTpl({message:"Upload file thành công và bắt đầu tự động lấy token.",classes:"uk-notify-message-success"});t(".atl-notify-js",e.el).html(s).show(),setTimeout(function(){t(".atl-notify-js",e.el).fadeOut(),t(".avt-filter-token-live").show();var a=t(".avt-has-filter").attr("data-start");t(".avt-total-token-check").attr("data-total",c.data),t(".avt-total-token-check").text(c.data),e.ajaxAction(a,1,c.data)},2e3),t(".avt-btn-auto",e.el).show()}}})}else{var i=e.errorFormTpl({message:"File sai định dạng",classes:"uk-notify-message-danger"});t(".atl-notify-js",e.el).html(i).show(),setTimeout(function(){t(".atl-notify-js",e.el).fadeOut()},3e3)}return!1},autoAccFb:function(){var e=this,a={abc:"123"};t.ajax({url:AVTDATA.SITE_URL+"/auto-acc-fb",type:"POST",data:a,success:function(a){if(!0===JSON.parse(a).status){c=e.errorFormTpl({message:"Upload file thành công",classes:"uk-notify-message-success"});t(".atl-notify-js",e.el).html(c).show(),setTimeout(function(){t(".atl-notify-js",e.el).fadeOut()},3e3),t(".avt-btn-auto",e.el).show()}else{var c=e.errorFormTpl({message:"Có lỗi xảy ra",classes:"uk-notify-message-danger"});t(".atl-notify-js",e.el).html(c).show(),setTimeout(function(){t(".atl-notify-js",e.el).fadeOut()},3e3)}}})},ajaxAction:function(e=0,a=1,c=0){var s=this,o={start:e,limit:a};t.post(AVTDATA.SITE_URL+"/auto-acc-fb",o,function(e){var o=JSON.parse(e);t(".avt-has-filter").attr("data-start",o.start),t(".avt-has-filter").text(o.start);var i=o.start/c*100;t(".avt-total-token-check-bar").css("width",i+"%"),t(".avt-c-token-live").text(o.tokenLive),t(".avt-c-token-die").text(o.tokenDie),o.start<c?s.ajaxAction(o.start,a,c):(t(".avt-message-limit").text(""),t(".pita-start-action").show())})},actionManage:function(e){var a=t(e.currentTarget).closest(".atl-action-manage").find("select[name=atl-action-manage]").val(),c=new Array;if("delete"==a){t(".avt-facebook-acc-check-child",this.el).each(function(){this.checked&&c.push(t(this).val())});var s={id:c};t.post(AVTDATA.SITE_URL+"/delete-facebook-acc",s,function(e){var a=JSON.parse(e);t.each(c,function(e,a){t(".avt-fb-acc-item-"+a).remove()}),altair_helpers.content_preloader_hide(),a.status?UIkit.modal.alert("Delete Success!"):UIkit.modal.alert("Delete False!")})}else UIkit.modal.alert("Please choose Action!");return!1},deleteFBacc:function(e){var a=t(e.currentTarget).attr("data-id"),c={id:a};return t.post(AVTDATA.SITE_URL+"/delete-facebook-acc",c,function(e){var c=JSON.parse(e);t(".avt-fb-acc-item-"+a).remove(),altair_helpers.content_preloader_hide(),c.status?UIkit.modal.alert("Delete Success!"):UIkit.modal.alert("Delete False!")}),!1}}))}(jQuery);