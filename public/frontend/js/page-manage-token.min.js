!function(t){"use strict";new(Backbone.View.extend({el:"#page-manage-token",events:{"click .avt-action-filter":"filterToken","submit #atl-form-file":"uploadFile"},errorFormTpl:_.template('<div class="uk-notify-message <%= classes %>">                                        <a class="uk-close"></a>                                        <div>                                           <%= message %>                                        </div>                                    </div>'),initialize:function(){},filterToken:function(){t(".avt-filter-token-live").show(),t(".avt-upload-token-live").hide();var a=t(".avt-filter-token-live .avt-has-filter").attr("data-start"),e=t(".avt-filter-token-live .avt-total-token-check").attr("data-total");this.ajajxCheckToken(a,1,e)},ajajxCheckToken:function(a=0,e=1,o=0){var i=this,l={start:a,limit:e};t.post(AVTDATA.SITE_URL+"/ajax-check-token",l,function(a){var l=JSON.parse(a);t(".avt-filter-token-live .avt-has-filter").attr("data-start",l.start),t(".avt-filter-token-live .avt-has-filter").text(l.start);var s=l.start/o*100;t(".avt-filter-token-live .avt-total-token-check-bar").css("width",s+"%"),l.start<o&&i.ajajxCheckToken(l.start,e,o)})},uploadFile:function(){var a=this,e=t("input[name=atl-upload-file]").prop("files")[0],o=e.type,i=["text/plain","application/msword"];if(o==i[0]||o==i[1]){var l=new FormData;l.append("file",e),t.ajax({url:AVTDATA.SITE_URL+"/upload-token-fb",type:"POST",data:l,contentType:!1,processData:!1,success:function(e){var o=JSON.parse(e);if(o.data){var i=a.errorFormTpl({message:"Upload file thành công và bắt đầu tự động lọc token.",classes:"uk-notify-message-success"});t(".atl-notify-js",a.el).html(i).show(),setTimeout(function(){t(".atl-notify-js",a.el).fadeOut(),t(".avt-upload-token-live").show();var e=t(".avt-upload-token-live  .avt-has-filter").attr("data-start");t(".avt-upload-token-live .avt-total-token-check").attr("data-total",o.data),t(".avt-upload-token-live .avt-total-token-check").text(o.data),a.ajaxAction(e,1,o.data)},2e3),t(".avt-btn-auto",a.el).show()}}})}else{var s=a.errorFormTpl({message:"File sai định dạng",classes:"uk-notify-message-danger"});t(".atl-notify-js",a.el).html(s).show(),setTimeout(function(){t(".atl-notify-js",a.el).fadeOut()},3e3)}return!1},ajaxAction:function(a=0,e=1,o=0){var i=this,l={start:a,limit:e};t.post(AVTDATA.SITE_URL+"/auto-check-token-upload",l,function(a){var l=JSON.parse(a);t(".avt-upload-token-live .avt-has-filter").attr("data-start",l.start),t(".avt-upload-token-live .avt-has-filter").text(l.start);var s=l.start/o*100;t(".avt-upload-token-live .avt-total-token-check-bar").css("width",s+"%"),l.start<o?i.ajaxAction(l.start,e,o):(t(".avt-message-limit").text(""),t(".pita-start-action").show())})}}))}(jQuery);