!function(e){"use strict";new(Backbone.View.extend({el:"#atl-page-handle-user",formClassError:"md-input-danger",events:{"submit #atl-form-user":"handleForm","click .atl-manage-user-filter-js li":"handleFilterByRole","click .atl-manage-user-delete-js":"removeUser","click .atl-action-apply-js":"actionManage","keyup .atl-user-manage-search-js":"searchManage"},errorFormTpl:_.template('<div class="uk-notify-message <%= classes %>">\t\t\t\t\t\t\t\t        <a class="uk-close"></a>\t\t\t\t\t\t\t\t        <div>\t\t\t\t\t\t\t\t           <%= message %>\t\t\t\t\t\t\t\t        </div>\t\t\t\t\t\t\t\t    </div>'),initialize:function(){var t=this;e(window).load(function(){var a=e(".atl-notify-js",t.el).attr("data-notify");if(a){var r=t.errorFormTpl({message:a,classes:"uk-notify-message-success"});e(".atl-notify-js",t.el).html(r).show(),setTimeout(function(){e(".atl-notify-js",t.el).fadeOut()},3e3)}}),ATLLIB.checkAll(this.el)},handleForm:function(t){var a=this,r=e(".atl-required-js",this.el),s=new Array;e.each(r,function(t,r){var l=e(r).val();"email"===e(r).attr("type")&&(!1===ATLLIB.validateEmail(l)?(e(r).addClass(a.formClassError),s.push(t)):(e(r).removeClass(a.formClassError),s.splice(t,1))),0===l.length?(e(r).addClass(a.formClassError),s.push(t)):(e(r).removeClass(a.formClassError),s.splice(t,1))});var l=e("input[name=atl_user_pass]",this.el),n=e("input[name=atl_user_cf_pass]",this.el);return 0===l.val().length||l.val()!=n.val()?(l.addClass(a.formClassError),n.addClass(a.formClassError),s.push(1)):(l.removeClass(a.formClassError),n.removeClass(a.formClassError)),0===s.length&&(this.handleUser(t),!1)},handleUser:function(t){var a={formData:e("#atl-form-user",this.el).serialize()},r=this;altair_helpers.content_preloader_show(),e.ajax({url:ATLDATA.adminUrl+"/validate-user",type:"POST",data:a,success:function(t){altair_helpers.content_preloader_hide();var a=JSON.parse(t);if(!1===a.status){var s="";e.each(a.message,function(e,t){s+=r.errorFormTpl({message:t,classes:"uk-notify-message-danger"})}),e(".atl-notify-js",r.el).html(s).show(),setTimeout(function(){e(".atl-notify-js",r.el).fadeOut()},3e3)}else window.location=location.href=ATLDATA.adminUrl+"/edit-user/"+a.id}})},handleFilterByRole:function(t){var a=this;altair_helpers.content_preloader_show(),e(".atl-manage-user-filter-js li",this.el).each(function(t,a){e(a).removeClass("uk-active")}),e(t.currentTarget).addClass("uk-active");var r={getBy:"role",roleStatus:e("a",t.currentTarget).attr("data-role")};return e.get(ATLDATA.adminUrl+"/ajax-manage-user",r,function(t){var r=JSON.parse(t);e(".atl-list-user-js",a.el).html(r.output),e(".atl-list-user-not-js",a.el).hide(),altair_helpers.content_preloader_hide()}),!1},removeUser:function(t){var a=e(t.currentTarget).attr("data-id");return UIkit.modal.confirm("Are you sure?",function(){var r={id:a};e.post(ATLDATA.adminUrl+"/delete-user",r,function(a){e(t.currentTarget).closest("tr").remove(),UIkit.modal.alert("Delete Success!")})}),!1},actionManage:function(t){var a=e(t.currentTarget).closest(".atl-action-manage").find("select[name=atl-action-manage]").val(),r=new Array;if("delete"==a){altair_helpers.content_preloader_show(),e(".atl-checkbox-child-js",this.el).each(function(){this.checked&&r.push(e(this).val())});var s={id:r};e.post(ATLDATA.adminUrl+"/delete-user",s,function(t){var a=JSON.parse(t);e.each(r,function(t,a){e(".atl-user-item-"+a).remove()}),altair_helpers.content_preloader_hide(),a.status?UIkit.modal.alert("Delete Success!"):UIkit.modal.alert("Delete False!")})}else UIkit.modal.alert("Please choose Action!")},searchManage:function(t){var a=e(t.currentTarget).val(),r={getBy:"search",keyup:a};0<a.length?(e(".atl-list-user-not-js",this.el).fadeOut(),e(".atl-list-user-js",this.el).fadeIn(),altair_helpers.content_preloader_show()):(e(".tl-list-user-not-js",this.el).fadeIn(),e(".tl-list-user-js",this.el).fadeOut(),altair_helpers.content_preloader_hide()),e.get(ATLDATA.adminUrl+"/ajax-manage-user",r,function(t){var a=JSON.parse(t);e(".atl-list-user-js",self.el).html(a.output),altair_helpers.content_preloader_hide()})}}))}(jQuery);